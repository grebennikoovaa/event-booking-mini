{% extends "base.html" %}
{% block title %}Events Â· Event Booking{% endblock %}

{% block content %}

<div class="d-flex flex-wrap align-items-start justify-content-between gap-3 mb-3">

  
  <div>
    <h1 class="h3 mb-1">Events</h1>
    <div class="text-secondary">Browse upcoming events and book a slot.</div>
  </div>

 
  <div class="d-flex flex-wrap gap-2 align-items-center">
    
    <div class="btn-group" role="group" aria-label="Filters">
      <a class="btn btn-outline-primary btn-sm {% if range == 'today' %}active{% endif %}"
         href="{% url 'event_list' %}?range=today{% if q %}&q={{ q }}{% endif %}">
        Today
      </a>

      <a class="btn btn-outline-primary btn-sm {% if range == 'week' %}active{% endif %}"
         href="{% url 'event_list' %}?range=week{% if q %}&q={{ q }}{% endif %}">
        This Week
      </a>

      <a class="btn btn-outline-secondary btn-sm {% if not range %}active{% endif %}"
         href="{% url 'event_list' %}{% if q %}?q={{ q }}{% endif %}">
        All
      </a>
    </div>

    
    <form class="d-flex gap-2" method="get">
      <input class="form-control form-control-sm"
             type="text"
             name="q"
             placeholder="Search events..."
             value="{{ q|default:'' }}"
             style="max-width: 260px;">

      {% if range %}
        <input type="hidden" name="range" value="{{ range }}">
      {% endif %}

      <button class="btn btn-primary btn-sm" type="submit">Search</button>
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'event_list' %}">Reset</a>
    </form>
  </div>
</div>


{% if q %}
  <div class="small text-secondary mb-3">
    Showing results for: <span class="fw-semibold">â€œ{{ q }}â€</span>
  </div>
{% endif %}


<div class="row g-3">
  {% for event in events %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">

         
          <div class="d-flex justify-content-between align-items-start gap-2 mb-2">
            <h2 class="h5 mb-0">{{ event.title }}</h2>

            {% if event.slots.count > 0 %}
              <span class="badge text-bg-success">Open</span>
            {% else %}
              <span class="badge text-bg-secondary">No slots</span>
            {% endif %}
          </div>

          
          <div class="text-secondary small mb-1">ğŸ“… {{ event.start_datetime }}</div>
          {% if event.location %}
            <div class="text-secondary small mb-3">ğŸ“ {{ event.location }}</div>
          {% endif %}

         
          <p class="text-secondary small flex-grow-1">
            {% if event.description %}
              {{ event.description|truncatechars:110 }}
            {% else %}
              No description.
            {% endif %}
          </p>

          
          <a class="btn btn-primary mt-auto" href="{% url 'event_detail' event.id %}">
            View details
          </a>
        </div>
      </div>
    </div>

  {% empty %}
    <div class="col-12">
      <div class="alert alert-info mb-0">
        No events found.
        {% if q or range %}
          Try <a class="alert-link" href="{% url 'event_list' %}">resetting filters</a>.
        {% else %}
          Add some via <a class="alert-link" href="/admin/">Admin</a>.
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
