{% extends "base.html" %}
{% block title %}{{ event.title }} ¬∑ Event Booking{% endblock %}

{% block content %}
<div class="mb-3">
  <a class="text-decoration-none" href="{% url 'event_list' %}">‚Üê Back to events</a>
</div>

<!-- Hero / Event info -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex flex-wrap justify-content-between align-items-start gap-2">
      <div>
        <h1 class="h3 mb-1">{{ event.title }}</h1>
        <div class="text-secondary small">üìÖ {{ event.start_datetime }}</div>
        {% if event.location %}
          <div class="text-secondary small">üìç {{ event.location }}</div>
        {% endif %}
      </div>

      <div class="text-end">
        <span class="badge text-bg-primary">Event</span>
      </div>
    </div>

    {% if event.description %}
      <hr>
      <p class="mb-0">{{ event.description }}</p>
    {% endif %}
  </div>
</div>

<!-- Slots -->
<div class="d-flex justify-content-between align-items-center mb-2">
  <h2 class="h5 mb-0">Available slots</h2>
  {% if not user.is_authenticated %}
    <div class="small text-secondary">
      To book a slot, <a href="/accounts/login/">login</a>.
    </div>
  {% endif %}
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Time</th>
          <th>Seats</th>
          <th class="text-end">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for slot in slots %}
          <tr>
            <td class="fw-semibold">{{ slot.start_datetime }}</td>
            <td>
              {% if slot.is_full %}
                <span class="badge text-bg-danger">Full</span>
              {% else %}
                <span class="badge text-bg-success">{{ slot.seats_left }} left</span>
              {% endif %}
            </td>
            <td class="text-end">
              {% if user.is_authenticated %}
                {% if slot.id in user_booked_slot_ids %}
                  <form method="post" action="{% url 'cancel_slot' slot.id %}" class="d-inline">
                    {% csrf_token %}
                    <button class="btn btn-outline-danger btn-sm" type="submit">Cancel</button>
                  </form>
                {% else %}
                  {% if slot.is_full %}
                    <button class="btn btn-outline-secondary btn-sm" disabled>Full</button>
                  {% else %}
                    <form method="post" action="{% url 'book_slot' slot.id %}" class="d-inline">
                      {% csrf_token %}
                      <button class="btn btn-primary btn-sm" type="submit">Book</button>
                    </form>
                  {% endif %}
                {% endif %}
              {% else %}
                <a class="btn btn-outline-primary btn-sm" href="/accounts/login/">Login</a>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="3" class="text-secondary">
              No slots yet. Add them in <a href="/admin/">Admin</a>.
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
