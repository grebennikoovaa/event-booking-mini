{% extends "base.html" %}
{% load static %}
{% block title %}{{ event.title }} Â· Easy Event{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/event_detail.css' %}">
{% endblock %}

{% block content %}

<div class="event-detail">

  
  <div class="poster-card">
    {% if event.poster %}
      <img class="poster-img" src="{{ event.poster.url }}" alt="Poster">
    {% else %}
      <div class="poster-placeholder">No poster</div>
    {% endif %}
  </div>

  
  <div class="event-info">
    <h1 class="event-title">{{ event.title }}</h1>

    <div class="event-meta">
      {% if event.next_slot %}
        <div class="meta-row">ğŸ—“ {{ event.next_slot|date:"d M Y" }} Â· ğŸ•’ {{ event.next_slot|date:"H:i" }}</div>
      {% endif %}
      {% if event.location %}
        <div class="meta-row">ğŸ“ {{ event.location }}</div>
      {% endif %}
    </div>

    {% if event.description %}
      <p class="event-desc">{{ event.description }}</p>
    {% endif %}

    <div class="slots-card">
      <div class="slots-head">Available slots</div>

      <div class="slots-table">
        <div class="slots-row slots-header">
          <div>Time</div>
          <div>Seats</div>
          <div class="text-end">Action</div>
        </div>

        {% for s in slots %}
          <div class="slots-row">
            <div class="slot-time">
              {{ s.start_datetime|date:"F j, Y, H:i" }}
            </div>

            
            <div class="slot-seats">
              <div class="seats-top">
                <span class="seats-left">{{ s.seats_left }} left</span>
                <span class="seats-total">/ {{ s.capacity }}</span>
              </div>

              <div class="seats-bar">
                {# percent filled = booked/capacity #}
                <div class="seats-fill" style="width: {{ s.percent_booked }}%;"></div>
              </div>
            </div>

           
            <div class="slot-action">
              {% if user.is_authenticated %}
                {% if s.is_booked_by_me %}
                  <form method="post" action="{% url 'cancel_slot' s.id %}">
                    {% csrf_token %}
                    <button class="btn btn-outline-dark btn-sm rounded-pill px-3" type="submit">
                      Cancel
                    </button>
                  </form>
                {% else %}
                  {% if s.seats_left > 0 %}
                    <form method="post" action="{% url 'book_slot' s.id %}">
                      {% csrf_token %}
                      <button class="btn btn-primary btn-sm rounded-pill px-3 fw-bold" type="submit">
                        Book
                      </button>
                    </form>
                  {% else %}
                    <button class="btn btn-secondary btn-sm rounded-pill px-3" disabled>
                      Full
                    </button>
                  {% endif %}
                {% endif %}
              {% else %}
                <a class="btn btn-primary btn-sm rounded-pill px-3 fw-bold" href="{% url 'login' %}">
                  Log in
                </a>
              {% endif %}
            </div>
          </div>
        {% empty %}
          <div class="text-secondary small py-2">No slots yet.</div>
        {% endfor %}
      </div>

    </div>
  </div>

</div>

{% endblock %}
